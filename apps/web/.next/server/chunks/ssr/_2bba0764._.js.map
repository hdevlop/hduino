{"version":3,"sources":["../../../../../../apps/web/src/hooks/useAutoSave.ts","../../../../../../node_modules/.bun/use-onclickoutside%400.4.1%2B83d5fd7b249dbeef/node_modules/use-onclickoutside/dist/use-onclickoutside.esm.js","../../../../../../node_modules/.bun/are-passive-events-supported%401.1.1/node_modules/are-passive-events-supported/dist/are-passive-events-supported.esm.js","../../../../../../node_modules/.bun/use-isomorphic-layout-effect%401.2.1%2B83d5fd7b249dbeef/node_modules/use-isomorphic-layout-effect/dist/use-isomorphic-layout-effect.esm.js","../../../../../../node_modules/.bun/use-latest%401.3.0%2B83d5fd7b249dbeef/node_modules/use-latest/dist/use-latest.esm.js","../../../../../../apps/web/src/app/editor/page.tsx"],"sourcesContent":["import { useEffect, useRef } from 'react';\nimport { useEditorStore } from '@/stores/editorStore';\nimport { toast } from 'sonner';\n\nconst AUTO_SAVE_DELAY = 3000; // 3 seconds after last change\n\nexport function useAutoSave() {\n  const { isDirty, saveProject, currentProject } = useEditorStore();\n  const autoSaveTimerRef = useRef<NodeJS.Timeout | null>(null);\n  const isSavingRef = useRef(false);\n\n  // Auto-save after inactivity\n  useEffect(() => {\n    if (!currentProject || !isDirty || isSavingRef.current) {\n      return;\n    }\n\n    // Clear existing timer\n    if (autoSaveTimerRef.current) {\n      clearTimeout(autoSaveTimerRef.current);\n    }\n\n    // Set new timer for auto-save\n    autoSaveTimerRef.current = setTimeout(async () => {\n      isSavingRef.current = true;\n      try {\n        await saveProject(true); // true = isAutoSave\n      } finally {\n        isSavingRef.current = false;\n      }\n    }, AUTO_SAVE_DELAY);\n\n    // Cleanup on unmount or when dependencies change\n    return () => {\n      if (autoSaveTimerRef.current) {\n        clearTimeout(autoSaveTimerRef.current);\n      }\n    };\n  }, [isDirty, currentProject, saveProject]);\n\n  // Auto-save on page unload/navigation\n  useEffect(() => {\n    if (!currentProject) return;\n\n    const handleBeforeUnload = async (e: BeforeUnloadEvent) => {\n      if (isDirty && !isSavingRef.current) {\n        // Prevent default to show browser dialog\n        e.preventDefault();\n\n        isSavingRef.current = true;\n\n        // Attempt synchronous save\n        try {\n          await saveProject(true);\n          toast.success('Auto-saved', {\n            description: 'Your work has been saved',\n            duration: 2000,\n          });\n        } catch (error) {\n          console.error('[useAutoSave] Failed to save on unload:', error);\n          toast.error('Failed to save', {\n            description: 'Could not save your changes',\n          });\n        } finally {\n          isSavingRef.current = false;\n        }\n      }\n    };\n\n    window.addEventListener('beforeunload', handleBeforeUnload);\n\n    return () => {\n      window.removeEventListener('beforeunload', handleBeforeUnload);\n    };\n  }, [isDirty, currentProject, saveProject]);\n}\n","import { useEffect } from 'react';\nimport arePassiveEventsSupported from 'are-passive-events-supported';\nimport useLatest from 'use-latest';\n\nvar MOUSEDOWN = 'mousedown';\nvar TOUCHSTART = 'touchstart';\nvar events = [MOUSEDOWN, TOUCHSTART];\n\nvar getAddOptions = function getAddOptions(event) {\n  if (event === TOUCHSTART && arePassiveEventsSupported()) {\n    return {\n      passive: true\n    };\n  }\n};\n\nvar currentDocument = typeof document !== 'undefined' ? document : undefined;\nfunction useOnClickOutside(ref, handler, _temp) {\n  var _ref = _temp === void 0 ? {} : _temp,\n      _ref$document = _ref.document,\n      document = _ref$document === void 0 ? currentDocument : _ref$document;\n\n  if (typeof document === 'undefined') {\n    return;\n  }\n\n  var handlerRef = useLatest(handler);\n  useEffect(function () {\n    if (!handler) {\n      return;\n    }\n\n    var listener = function listener(event) {\n      if (!ref.current || !handlerRef.current || ref.current.contains(event.target)) {\n        return;\n      }\n\n      handlerRef.current(event);\n    };\n\n    events.forEach(function (event) {\n      document.addEventListener(event, listener, getAddOptions(event));\n    });\n    return function () {\n      events.forEach(function (event) {\n        document.removeEventListener(event, listener);\n      });\n    };\n  }, [!handler]);\n}\n\nexport { useOnClickOutside as default };\n","var isBrowser = typeof document !== 'undefined';\n\nvar supportsPassiveEvents;\nfunction arePassiveEventsSupported() {\n  if (supportsPassiveEvents !== undefined) {\n    return supportsPassiveEvents;\n  }\n\n  if (!(isBrowser)) {\n    supportsPassiveEvents = false;\n    return false;\n  }\n\n  var passive = false;\n  var options = {\n    // @ts-ignore: this is a temporary object, it doesn't have to return anything\n    get passive() {\n      passive = true;\n    }\n\n  };\n\n  var noop = function noop() {};\n\n  window.addEventListener('t', noop, options);\n  window.removeEventListener('t', noop, options);\n  supportsPassiveEvents = passive;\n  return passive;\n}\n\nexport default arePassiveEventsSupported;\n","import { useLayoutEffect } from 'react';\n\nvar isClient = typeof document !== 'undefined';\n\nvar noop = function noop() {};\nvar index = isClient ? useLayoutEffect : noop;\n\nexport { index as default };\n","import React from 'react';\nimport useIsomorphicLayoutEffect from 'use-isomorphic-layout-effect';\n\nvar useLatest = function useLatest(value) {\n  var ref = React.useRef(value);\n  useIsomorphicLayoutEffect(function () {\n    ref.current = value;\n  });\n  return ref;\n};\n\nexport { useLatest as default };\n","'use client';\n\nimport { useEditorStore } from '@/stores/editorStore';\nimport { useAutoSave } from '@/hooks/useAutoSave';\nimport { EditorToolbar } from '@/components/editor/Toolbar';\n\nimport { useEffect, useRef } from 'react';\nimport { CategorySidebar, CodePanel, WorkspaceContainer, VariableDialog } from '@/components/editor';\nimport useOnClickOutside from 'use-onclickoutside';\n\nexport default function EditorPage() {\n  const {\n    currentProject: project,\n    isDirty,\n    generatedCode,\n    selectedCategory,\n    isCodePanelOpen,\n    closeProject,\n    selectCategory,\n    toggleCodePanel,\n    copyCodeToClipboard,\n    undo,\n    redo,\n  } = useEditorStore();\n\n  const sidebarRef = useRef<HTMLDivElement>(null);\n\n  // Enable auto-save\n  useAutoSave();\n\n  // Close flyout when clicking outside sidebar and flyout\n  useOnClickOutside(sidebarRef, () => {\n    if (selectedCategory) {\n      selectCategory(null);\n    }\n  });\n\n  // Keyboard shortcuts\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      // Undo: Ctrl+Z or Cmd+Z\n      if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {\n        e.preventDefault();\n        undo();\n      }\n      // Redo: Ctrl+Y or Cmd+Shift+Z\n      if (\n        ((e.ctrlKey || e.metaKey) && e.key === 'y') ||\n        ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'z')\n      ) {\n        e.preventDefault();\n        redo();\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [undo, redo]);\n\n  // If no project loaded yet, don't render\n  if (!project) {\n    return null;\n  }\n\n  const handleCopyCode = async () => {\n    await copyCodeToClipboard();\n  };\n\n  return (\n    <>\n      <div className=\"h-screen w-screen flex flex-col overflow-hidden\">\n\n        <EditorToolbar\n          project={project}\n          isDirty={isDirty}\n          isCodePanelOpen={isCodePanelOpen}\n          onToggleCodePanel={toggleCodePanel}\n          onClose={closeProject}\n        />\n\n\n        <div className=\"flex relative flex-1 overflow-hidden h-full\">\n\n          <CategorySidebar\n            selectedCategory={selectedCategory}\n            onSelectCategory={(categoryId) => {\n              if (categoryId === selectedCategory) {\n                selectCategory(null);\n              } else {\n                selectCategory(categoryId);\n              }\n            }}\n          />\n\n          <WorkspaceContainer />\n\n\n          {isCodePanelOpen && (\n            <CodePanel\n              code={generatedCode}\n              onCopy={handleCopyCode}\n              onClose={toggleCodePanel}\n            />\n          )}\n        </div>\n      </div>\n\n      {/* Variable Dialog - follows same pattern as ProjectDialog/DeleteConfirmDialog */}\n      <VariableDialog />\n    </>\n  );\n}\n"],"names":[],"mappings":"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","ignoreList":[1,2,3,4]}